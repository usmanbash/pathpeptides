    <!-- Calculator -->
    <style>
      .peer:checked ~ .peer-checked-bg {
        background-color: {{ section.settings.unit_selected_background_color }};
      }
      #result .error {
        color: red;
        font-size: 1rem;
      }
    </style>
    <div class="px-4 sm:px-8 md:px-[82px] pt-0 pb-[120px] flex flex-col gap-0 justify-center items-center relative w-full max-w-[1440px] mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-5 w-full" style="background-color: {{ section.settings.background_color }};">
        
        <!-- Left Image -->
        {% if section.settings.image != blank %}
          <img src="{{ section.settings.image | img_url: 'master' }}" class="w-full h-full rounded-[10px]">
        {% else %}
          <img src="https://cdn.shopify.com/s/files/1/0959/4722/7449/files/cal-img.webp?v=1757789178" class="w-full h-full rounded-[10px]">
        {% endif %}

        <!-- Right Form -->
        <div class="rounded-[10px] p-6 sm:p-10 md:p-[54px] flex flex-col gap-6 items-start flex-1 h-full w-full max-w-full md:max-w-[628px] right-form" style="background-color: {{ section.settings.form_background_color }};">
          <h1 class="text-3xl sm:text-4xl md:text-5xl leading-tight md:leading-[58px] text-[#0c0c0c] font-normal"> {{ section.settings.heading }} </h1>
          <h5 class="text-lg sm:text-xl leading-6 text-[#303030] font-normal"> {{ section.settings.subheading }} </h5>
          <div class="flex flex-col gap-10 items-start w-full flex-1">
            <!-- Input Group -->
            <div class="flex flex-col gap-6 w-full">
              <div class="flex flex-col gap-2 w-full">
                <label class="text-base leading-[22px] text-[#303030]" for="peptide-amount"> {{ section.settings.peptide_amount_label }} </label>
                <input id="peptide-amount" class="w-full text-base rounded-[50px] h-[52px] bg-white placeholder-[#121217]/40 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-300" placeholder="{{ section.settings.peptide_amount_placeholder }}" aria-label="Amount of Peptide Input" />
              </div>
              <div class="flex flex-col sm:flex-row gap-6 w-full">
                <div class="flex flex-col gap-2 flex-1">
                  <label class="text-base leading-[22px] text-[#303030]" for="desired-dosage"> {{ section.settings.desired_dosage_label }} </label>
                  <input id="desired-dosage" class="rounded-[50px] text-base px-5 w-full h-[52px] bg-white placeholder-[#121217]/40 focus:outline-none focus:ring-2 focus:ring-blue-300" placeholder="{{ section.settings.desired_dosage_placeholder }}" aria-label="Desired Dosage Input" />
                </div>
                <div class="flex flex-col gap-2 flex-1">
                  <label class="text-base leading-[22px] text-[#303030]" for="dosage-unit"> {{ section.settings.dosage_unit_label }} </label>
                  <div class="flex rounded-full  overflow-hidden">
                    <!-- mcg -->
                    <label class="flex-1">
                      <input type="radio" name="unit" value="mcg" class="peer hidden" checked />
                      <span class="block rounded-full relative z-1 mr-[-20px] text-center text-base px-5 py-[15px] cursor-pointer text-[#121217]/40 bg-[#ffffff] peer-checked-bg peer-checked:text-[rgba(48,48,48,1)] peer-checked:font-medium"> {{ section.settings.unit_1 }} </span>
                    </label>
                    <!-- mg -->
                    <label class="flex-1">
                      <input type="radio" name="unit" value="mg" class="peer hidden" />
                      <span class="block rounded-full ml-[-20px] text-center text-base px-4 py-[15px] cursor-pointer text-[#121217]/40  bg-[#ffffff] peer-checked-bg peer-checked:text-[rgba(48,48,48,1)] peer-checked:font-medium"> {{ section.settings.unit_2 }} </span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
            <!-- Button -->
            <button class="w-full rounded-[50px] px-6 py-4 flex justify-center items-center hover:bg-blue-600 focus:ring-2 focus:ring-blue-300" style="background-color: {{ section.settings.button_background_color }};">
              <span class="text-base leading-normal uppercase text-white font-bold"> {{ section.settings.button_text }} </span>
            </button>
            <!-- Result -->
            <div id="result" class="mt-6 text-start text-lg"></div>
          </div>
        </div>
      </div>
    </div>
    <!-- End Calculator -->

    <script>
document.addEventListener('DOMContentLoaded', function () {
    const peptideAmountInput = document.getElementById('peptide-amount');
    const desiredDosageInput = document.getElementById('desired-dosage');
    const calculateButton = document.querySelector('.right-form button');
    const resultDiv = document.getElementById('result');

    calculateButton.addEventListener('click', function () {
        const peptideAmount = parseFloat(peptideAmountInput.value);
        const desiredDosageRaw = parseFloat(desiredDosageInput.value);
        const dosageUnit = document.querySelector('input[name="unit"]:checked')?.value;

        if (isNaN(peptideAmount) || isNaN(desiredDosageRaw) || peptideAmount <= 0 || desiredDosageRaw <= 0) {
            resultDiv.innerHTML = "<span class='error'>⚠️ Please enter valid numbers in all fields.</span>";
            return;
        }

        const desiredDosageInMg = dosageUnit === 'mcg' ? desiredDosageRaw / 1000 : desiredDosageRaw;
        const vialSizeInMcg = peptideAmount * 1000;
        const desiredDosageInMcg = desiredDosageInMg * 1000;

        const ratio = vialSizeInMcg / desiredDosageInMcg;

        let bacWater;
        if (ratio < 5) {
            bacWater = 0.5;
        } else if (ratio >= 5 && ratio <= 10) {
            bacWater = 1;
        } else {
            bacWater = 2;
        }

        resultDiv.innerHTML = `
            <p class="text-base text-[#303030]">For a peptide vial of <b>${peptideAmount}mg</b> and a dosage of <b>${desiredDosageRaw}${dosageUnit}</b>.</p>
            <p class="text-base text-[#303030]">ADD <strong>${bacWater}mL</strong> OF BACTERIOSTATIC WATER TO THE VIAL.</p>
        `;
    });
});
</script>


{% schema %}
{
  "name": "Calculator",
  "settings": [
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Reconstitution Calculator"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Enter the details below to calculate how much bacteriostatic water is needed to reconstitute the peptide."
    },
    {
      "type": "text",
      "id": "peptide_amount_label",
      "label": "Peptide Amount Label",
      "default": "Amount of Peptide in Vial (mg):"
    },
    {
      "type": "text",
      "id": "peptide_amount_placeholder",
      "label": "Peptide Amount Placeholder",
      "default": "Enter mg"
    },
    {
      "type": "text",
      "id": "desired_dosage_label",
      "label": "Desired Dosage Label",
      "default": "Desired Dosage:"
    },
    {
      "type": "text",
      "id": "desired_dosage_placeholder",
      "label": "Desired Dosage Placeholder",
      "default": "Enter dosage"
    },
    {
      "type": "text",
      "id": "dosage_unit_label",
      "label": "Dosage Unit Label",
      "default": "Dosage Unit:"
    },
    {
      "type": "text",
      "id": "unit_1",
      "label": "Unit 1",
      "default": "mcg"
    },
    {
      "type": "text",
      "id": "unit_2",
      "label": "Unit 2",
      "default": "mg"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Enter dosage"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "form_background_color",
      "label": "Form Background Color",
      "default": "#f8f8f8"
    },
    {
      "type": "color",
      "id": "button_background_color",
      "label": "Button Background Color",
      "default": "#008cff"
    },
    {
      "type": "color",
      "id": "unit_selected_background_color",
      "label": "Unit Selected Background Color",
      "default": "#D6CFC0"
    }
  ],
  "presets": [
    {
      "name": "Calculator"
    }
  ]
}
{% endschema %}